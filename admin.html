<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Football Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .modal-content {
      max-height: 80vh;
      overflow-y: auto;
    }

    .w-10 {
      width: 10%;
    }

    .w-15 {
      width: 15%;
    }
  </style>
</head>

<body class="container mt-4">
  <h1 class="text-center mb-4">Football Admin Panel</h1>

  <!-- Admin Login Section -->
  <div id="adminLoginSection" class="mb-4 card p-3">
    <h3>Admin Login</h3>
    <div class="row g-3 align-items-center mb-3">
      <div class="col-auto">
        <label for="adminUsername" class="col-form-label">Username:</label>
      </div>
      <div class="col-auto">
        <input type="text" id="adminUsername" class="form-control" value="admin">
      </div>
    </div>
    <div class="row g-3 align-items-center mb-3">
      <div class="col-auto">
        <label for="adminPassword" class="col-form-label">Password:</label>
      </div>
      <div class="col-auto">
        <input type="password" id="adminPassword" class="form-control" value="admin123">
      </div>
    </div>
    <button id="adminLogin" class="btn btn-primary">Login</button>
    <div id="loginStatus" class="mt-2"></div>
  </div>

  <!-- Admin Panel (initially hidden) -->
  <div id="adminPanel" style="display: none;">
    <div class="mb-4">
      <div class="input-group mb-2">
        <input type="text" id="sportKey" placeholder="Sport Key" class="form-control w-25" style="display: none;">
        <input type="text" id="sportKeyDisplay" placeholder="Click 'Fetch Sports' to select a league"
          class="form-control w-25" readonly>
        <button id="fetchSports" class="btn btn-primary">Fetch Sports</button>
      </div>
      <div>
        <button id="fetchOdds" class="btn btn-primary">Fetch Odds</button>
        <button id="fetchScores" class="btn btn-primary ms-2">Fetch Scores</button>
        <button id="queryMatches" class="btn btn-info ms-2">Query All Matches</button>
        <button id="createSampleMatches" class="btn btn-success ms-2">Create Sample Matches</button>
        <button id="deleteAllMatches" class="btn btn-danger ms-2">Delete All Matches</button>
      </div>
    </div>

    <!-- User Management Section -->
    <div class="mb-4 card p-3">
      <h2 class="mb-3">User Management</h2>
      <div class="row g-3 align-items-center mb-3">
        <div class="col-auto">
          <label for="resetUsername" class="col-form-label">Username to Reset:</label>
        </div>
        <div class="col-auto">
          <input type="text" id="resetUsername" class="form-control">
        </div>
        <div class="col-auto">
          <button id="resetUser" class="btn btn-warning">Reset User</button>
        </div>
      </div>
      <div id="resetStatus" class="mt-2"></div>
    </div>

    <div id="matchForm" class="mb-4">
      <h2 class="mb-3">Matches</h2>
      <button id="addMatch" class="btn btn-primary mb-2">Add Match</button>
      <div id="matchesContainer"></div>
      <button id="submitMatches" class="btn btn-success mt-2">Submit Matches</button>
      <div id="status" class="mt-2"></div>
    </div>
  </div>

  <!-- Result Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="resultModalLabel">Match Result</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="resultContent">
          <!-- Result content will be dynamically filled -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let matchCount = 0;
    let adminToken = '';

    // Admin login functionality
    document.getElementById('adminLogin').addEventListener('click', async () => {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;

      try {
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        if (response.ok) {
          const data = await response.json();
          adminToken = data.token;
          document.getElementById('loginStatus').innerHTML = `
            <div class="alert alert-success">Login successful!</div>
          `;
          document.getElementById('adminLoginSection').style.display = 'none';
          document.getElementById('adminPanel').style.display = 'block';
        } else {
          const error = await response.json();
          document.getElementById('loginStatus').innerHTML = `
            <div class="alert alert-danger">${error.message || 'Login failed'}</div>
          `;
        }
      } catch (error) {
        console.error('Login error:', error);
        document.getElementById('loginStatus').innerHTML = `
          <div class="alert alert-danger">Login failed. Please try again.</div>
        `;
      }
    });

    // User reset functionality
    document.getElementById('resetUser').addEventListener('click', async () => {
      const username = document.getElementById('resetUsername').value;
      if (!username) {
        document.getElementById('resetStatus').innerHTML = `
          <div class="alert alert-warning">Please enter a username to reset</div>
        `;
        return;
      }

      try {
        // First check if the user exists
        const checkUserResponse = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/user-predictions/${username}`);
        if (!checkUserResponse.ok) {
          document.getElementById('resetStatus').innerHTML = `
            <div class="alert alert-warning">User "${username}" not found</div>
          `;
          return;
        }

        // Reset the user
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/reset-user`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token: adminToken, username })
        });

        if (response.ok) {
          const data = await response.json();
          document.getElementById('resetStatus').innerHTML = `
            <div class="alert alert-success">${data.message}</div>
          `;
          document.getElementById('resetUsername').value = '';
        } else {
          const error = await response.json();
          document.getElementById('resetStatus').innerHTML = `
            <div class="alert alert-danger">${error.message || 'Reset failed'}</div>
          `;
        }
      } catch (error) {
        console.error('Reset error:', error);
        document.getElementById('resetStatus').innerHTML = `
          <div class="alert alert-danger">Reset failed. Please try again.</div>
        `;
      }
    });

    document.getElementById('fetchSports').addEventListener('click', async () => {
      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Fetching available sports...</div>
        `;
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/sports`);
        if (!response.ok) {
          throw new Error('Failed to fetch sports');
        }
        const sports = await response.json();

        // Create a modal to display and select sports
        let sportsHtml = `
          <div class="mb-3">
            <input type="text" id="sportSearch" class="form-control" placeholder="Search sports...">
          </div>
          <div class="list-group" id="sportsList">
        `;

        sports.forEach(sport => {
          sportsHtml += `
            <button type="button" class="list-group-item list-group-item-action" 
              data-sport-key="${sport.key}" data-sport-title="${sport.title}">
              <strong>${sport.title}</strong> <small class="text-muted">(${sport.key})</small>
            </button>
          `;
        });

        sportsHtml += `</div>`;

        // Show the sports in a modal
        document.getElementById('resultModalLabel').textContent = 'Available Sports';
        document.getElementById('resultContent').innerHTML = sportsHtml;

        // Add search functionality
        document.getElementById('sportSearch').addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          document.querySelectorAll('#sportsList button').forEach(btn => {
            const title = btn.dataset.sportTitle.toLowerCase();
            const key = btn.dataset.sportKey.toLowerCase();
            if (title.includes(searchTerm) || key.includes(searchTerm)) {
              btn.style.display = '';
            } else {
              btn.style.display = 'none';
            }
          });
        });

        // Add click handlers for sport selection
        document.querySelectorAll('#sportsList button').forEach(btn => {
          btn.addEventListener('click', () => {
            const sportKey = btn.dataset.sportKey;
            document.getElementById('sportKey').value = sportKey;
            document.getElementById('sportKeyDisplay').value = `${btn.dataset.sportTitle} (${sportKey})`;
            bootstrap.Modal.getInstance(document.getElementById('resultModal')).hide();

            // Show a success message with instructions for next steps
            document.getElementById('status').innerHTML = `
              <div class="alert alert-success">
                Sport selected: ${btn.dataset.sportTitle} (${sportKey})
                <br>
                <small>You can now click "Fetch Odds" to get matches for this league, or "Query All Matches" to see existing matches.</small>
              </div>
            `;
          });
        });

        const modal = new bootstrap.Modal(document.getElementById('resultModal'));
        modal.show();
        document.getElementById('status').innerHTML = '';
      } catch (error) {
        console.error('Error fetching sports:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">Error fetching sports: ${error.message}</div>
        `;
      }
    });

    document.getElementById('fetchOdds').addEventListener('click', async () => {
      const sportKey = document.getElementById('sportKey').value;
      if (!sportKey) return alert('Please enter a sport key');

      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Fetching odds for ${sportKey}...</div>
        `;

        // Try to fetch odds from the API
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/odds/${sportKey}`);

        // If API call fails, show detailed error and try to use sample matches instead
        if (!response.ok) {
          console.error('Failed to fetch odds from API, status:', response.status);

          // Show error message with option to create sample matches
          document.getElementById('status').innerHTML = `
            <div class="alert alert-warning">
              <p>Could not fetch odds from the API. This could be due to API limits or network issues.</p>
              <p>You can use "Create Sample Matches" to generate test data instead.</p>
              <button id="createSampleMatchesNow" class="btn btn-success mt-2">Create Sample Matches Now</button>
            </div>
          `;

          // Add event listener for the new button
          document.getElementById('createSampleMatchesNow').addEventListener('click', async () => {
            try {
              document.getElementById('status').innerHTML = `
                <div class="alert alert-info">Creating sample matches for ${sportKey}...</div>
              `;

              const sampleResponse = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/create-sample-matches`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sportKey }),
              });

              if (!sampleResponse.ok) {
                const errorData = await sampleResponse.json();
                throw new Error(errorData.error || 'Failed to create sample matches');
              }

              const data = await sampleResponse.json();
              document.getElementById('status').innerHTML = `
                <div class="alert alert-success">
                  ${data.message} (${data.count} matches created)
                </div>
              `;

              // Display the newly created matches
              displayMatches(data.matches);
            } catch (error) {
              console.error('Error creating sample matches:', error);
              document.getElementById('status').innerHTML = `
                <div class="alert alert-danger">
                  ${error.message || 'Error creating sample matches. Please try again.'}
                </div>
              `;
            }
          });

          return;
        }

        // If API call succeeds, process the data
        const data = await response.json();
        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">${data.message} (${data.count} matches)</div>
        `;

        // Fetch and display the matches
        fetchMatches(sportKey);
      } catch (error) {
        console.error('Error fetching odds:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">
            <p>Error fetching odds: ${error.message || 'Unknown error'}</p>
            <p>Try using "Create Sample Matches" instead.</p>
          </div>
        `;
      }
    });

    document.getElementById('fetchScores').addEventListener('click', async () => {
      const sportKey = document.getElementById('sportKey').value;
      if (!sportKey) return alert('Please enter a sport key');

      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Fetching scores for ${sportKey}...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/scores/${sportKey}`);
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to fetch scores');
        }

        const data = await response.json();
        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">${data.message} (${data.count} matches updated)</div>
        `;

        fetchMatches(sportKey);
      } catch (error) {
        console.error('Error fetching scores:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">${error.message || 'Failed to fetch scores'}</div>
        `;
      }
    });

    document.getElementById('queryMatches').addEventListener('click', async () => {
      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Fetching all matches...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/all-matches`);
        if (!response.ok) {
          throw new Error('Failed to fetch matches');
        }

        const matches = await response.json();
        displayMatches(matches);

        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">Found ${matches.length} matches</div>
        `;
      } catch (error) {
        console.error('Error querying matches:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">${error.message || 'Failed to query matches'}</div>
        `;
      }
    });

    document.getElementById('addMatch').addEventListener('click', () => {
      matchCount++;
      const container = document.getElementById('matchesContainer');
      const matchDiv = document.createElement('div');
      matchDiv.className = 'card mb-3 p-3';
      matchDiv.innerHTML = `
        <div class="d-flex align-items-center">
          <input type="text" placeholder="Match ID" class="form-control w-25" data-type="matchId" data-id="match${matchCount}">
          <input type="text" placeholder="Team A" class="form-control ms-2 w-15" data-type="teamA" data-id="match${matchCount}">
          <input type="text" placeholder="Team B" class="form-control ms-2 w-15" data-type="teamB" data-id="match${matchCount}">
          <input type="number" placeholder="Odds A" step="0.1" class="form-control ms-2 w-10" data-type="oddsA" data-id="match${matchCount}">
          <input type="number" placeholder="Odds B" step="0.1" class="form-control ms-2 w-10" data-type="oddsB" data-id="match${matchCount}">
          <input type="number" placeholder="Score A" class="form-control ms-2 w-10" data-type="scoreA" data-id="match${matchCount}" oninput="updateResult(this)">
          <input type="number" placeholder="Score B" class="form-control ms-2 w-10" data-type="scoreB" data-id="match${matchCount}" oninput="updateResult(this)">
          <span id="result${matchCount}" class="ms-2">pending</span>
          <button class="btn btn-danger ms-2 removeMatch" data-id="match${matchCount}">Remove</button>
        </div>
      `;
      container.appendChild(matchDiv);
      document.querySelector(`[data-id="match${matchCount}"].removeMatch`).addEventListener('click', () => matchDiv.remove());
    });

    function updateResult(input) {
      const id = input.dataset.id;
      const scoreA = parseInt(document.querySelector(`[data-type="scoreA"][data-id="${id}"]`).value) || 0;
      const scoreB = parseInt(document.querySelector(`[data-type="scoreB"][data-id="${id}"]`).value) || 0;
      const resultSpan = document.getElementById(`result${id.replace('match', '')}`);
      if (resultSpan) {
        resultSpan.textContent = scoreA > scoreB ? 'teamA' : scoreA < scoreB ? 'teamB' : 'draw';
      }
    }

    async function checkMatchResult(button) {
      const id = button.dataset.id;
      const matchId = document.querySelector(`[data-type="matchId"][data-id="${id}"]`).value;

      try {
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/results/${matchId}`);
        if (!response.ok) {
          throw new Error('Failed to fetch match results');
        }

        const match = await response.json();

        let resultText = `<h5>${match.teamA} vs ${match.teamB}</h5>`;
        resultText += `<p>Current Score: ${match.scoreA !== null ? match.scoreA : 'N/A'} - ${match.scoreB !== null ? match.scoreB : 'N/A'}</p>`;
        resultText += `<p>Status: ${match.status}</p>`;
        resultText += `<p>Result: ${match.result || 'pending'}</p>`;

        document.getElementById('resultContent').innerHTML = resultText;
        const modal = new bootstrap.Modal(document.getElementById('resultModal'));
        modal.show();
      } catch (error) {
        console.error('Error checking match result:', error);
        alert('Error checking match result: ' + error.message);
      }
    }

    function displayMatches(matches) {
      const container = document.getElementById('matchesContainer');
      container.innerHTML = '';

      if (matches.length === 0) {
        container.innerHTML = `
          <div class="alert alert-info">No matches found</div>
        `;
        return;
      }

      // Add filter controls
      const filterDiv = document.createElement('div');
      filterDiv.className = 'mb-3';
      filterDiv.innerHTML = `
        <div class="row">
          <div class="col-md-4">
            <input type="text" id="filterTeam" class="form-control" placeholder="Filter by team name">
          </div>
          <div class="col-md-4">
            <select id="filterSportKey" class="form-control">
              <option value="">All Sport Keys</option>
              ${[...new Set(matches.map(m => m.sportKey))].map(key =>
        `<option value="${key}">${key}</option>`
      ).join('')}
            </select>
          </div>
          <div class="col-md-4">
            <button id="applyFilter" class="btn btn-primary">Apply Filter</button>
            <button id="clearFilter" class="btn btn-secondary ms-2">Clear Filter</button>
          </div>
        </div>
      `;
      container.appendChild(filterDiv);

      // Add matches count
      const countDiv = document.createElement('div');
      countDiv.className = 'mb-3';
      countDiv.innerHTML = `<p><strong>Total matches:</strong> ${matches.length}</p>`;
      container.appendChild(countDiv);

      // Create matches container
      const matchesDiv = document.createElement('div');
      matchesDiv.id = 'matches';
      container.appendChild(matchesDiv);

      // Display all matches
      displayFilteredMatches(matches);

      // Add filter functionality
      document.getElementById('applyFilter').addEventListener('click', () => {
        const teamFilter = document.getElementById('filterTeam').value.toLowerCase();
        const sportKeyFilter = document.getElementById('filterSportKey').value;

        const filteredMatches = matches.filter(match => {
          const teamMatch = !teamFilter ||
            match.teamA.toLowerCase().includes(teamFilter) ||
            match.teamB.toLowerCase().includes(teamFilter);
          const sportKeyMatch = !sportKeyFilter || match.sportKey === sportKeyFilter;
          return teamMatch && sportKeyMatch;
        });

        displayFilteredMatches(filteredMatches);
      });

      document.getElementById('clearFilter').addEventListener('click', () => {
        document.getElementById('filterTeam').value = '';
        document.getElementById('filterSportKey').value = '';
        displayFilteredMatches(matches);
      });
    }

    // Add a function to add selected matches to frontend
    function addSelectedMatchesToFrontend() {
      const selectedMatches = document.querySelectorAll('.match-selected');
      if (selectedMatches.length === 0) {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-warning">No matches selected. Please select matches first.</div>
        `;
        return;
      }

      // Create simplified match IDs (m1, m2, etc.) for frontend
      const frontendMatches = [];
      selectedMatches.forEach((matchDiv, index) => {
        const matchId = matchDiv.dataset.matchId;
        const teamA = matchDiv.querySelector('[data-type="teamA"]').value;
        const teamB = matchDiv.querySelector('[data-type="teamB"]').value;
        const oddsA = parseFloat(matchDiv.querySelector('[data-type="oddsA"]').value) || 0;
        const oddsB = parseFloat(matchDiv.querySelector('[data-type="oddsB"]').value) || 0;

        frontendMatches.push({
          matchId: `m${index + 1}`, // Simplified ID for frontend (m1, m2, etc.)
          originalId: matchId,
          teamA: teamA,
          teamB: teamB,
          oddsA: oddsA,
          oddsB: oddsB,
          scoreA: null,
          scoreB: null,
          sportKey: document.getElementById('sportKey').value
        });
      });

      // Submit these matches to the server
      submitFrontendMatches(frontendMatches);
    }

    // Function to submit frontend matches
    async function submitFrontendMatches(frontendMatches) {
      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Adding ${frontendMatches.length} matches to frontend...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/matches`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ matches: frontendMatches }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to add matches to frontend');
        }

        const data = await response.json();
        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">
            ${data.message} (${frontendMatches.length} matches added to frontend)
            <br>
            <small>Match IDs have been simplified to m1, m2, etc. for easier frontend use.</small>
          </div>
        `;

        // Fetch all matches to refresh the display
        const sportKey = document.getElementById('sportKey').value;
        fetchMatches(sportKey);
      } catch (error) {
        console.error('Error adding matches to frontend:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">${error.message || 'Failed to add matches to frontend'}</div>
        `;
      }
    }

    function displayFilteredMatches(matches) {
      const container = document.getElementById('matches');
      container.innerHTML = '';

      if (matches.length === 0) {
        container.innerHTML = `
          <div class="alert alert-info">No matches found with current filters</div>
        `;
        return;
      }

      // Add "Add Selected to Frontend" button at the top
      const actionDiv = document.createElement('div');
      actionDiv.className = 'mb-3';
      actionDiv.innerHTML = `
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <button id="selectAllMatches" class="btn btn-outline-primary me-2">Select All</button>
            <button id="deselectAllMatches" class="btn btn-outline-secondary me-2">Deselect All</button>
          </div>
          <button id="addSelectedToFrontend" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Add Selected Matches to Frontend
          </button>
        </div>
      `;
      container.appendChild(actionDiv);

      // Add event listeners for the new buttons
      document.getElementById('selectAllMatches').addEventListener('click', () => {
        document.querySelectorAll('.match-checkbox').forEach(checkbox => {
          checkbox.checked = true;
          checkbox.closest('.card').classList.add('match-selected');
          checkbox.closest('.card').style.backgroundColor = '#e8f4ff';
        });
      });

      document.getElementById('deselectAllMatches').addEventListener('click', () => {
        document.querySelectorAll('.match-checkbox').forEach(checkbox => {
          checkbox.checked = false;
          checkbox.closest('.card').classList.remove('match-selected');
          checkbox.closest('.card').style.backgroundColor = '';
        });
      });

      document.getElementById('addSelectedToFrontend').addEventListener('click', addSelectedMatchesToFrontend);

      matches.forEach(match => {
        matchCount++;
        const matchDiv = document.createElement('div');
        matchDiv.className = 'card mb-3 p-3';
        matchDiv.dataset.matchId = match.matchId;
        matchDiv.innerHTML = `
          <div class="d-flex align-items-center">
            <div class="form-check me-2">
              <input class="form-check-input match-checkbox" type="checkbox" id="checkbox${matchCount}">
            </div>
            <input type="text" value="${match.matchId}" class="form-control w-25" data-type="matchId" data-id="match${matchCount}" readonly>
            <input type="text" value="${match.teamA}" class="form-control ms-2 w-15" data-type="teamA" data-id="match${matchCount}">
            <input type="text" value="${match.teamB}" class="form-control ms-2 w-15" data-type="teamB" data-id="match${matchCount}">
            <input type="number" value="${match.oddsA || ''}" step="0.1" class="form-control ms-2 w-10" data-type="oddsA" data-id="match${matchCount}">
            <input type="number" value="${match.oddsB || ''}" step="0.1" class="form-control ms-2 w-10" data-type="oddsB" data-id="match${matchCount}">
            <input type="number" value="${match.scoreA || ''}" class="form-control ms-2 w-10" data-type="scoreA" data-id="match${matchCount}" oninput="updateResult(this)">
            <input type="number" value="${match.scoreB || ''}" class="form-control ms-2 w-10" data-type="scoreB" data-id="match${matchCount}" oninput="updateResult(this)">
            <span id="result${matchCount}" class="ms-2">${match.result || 'pending'}</span>
            <button class="btn btn-danger ms-2 deleteMatch" data-match-id="${match.matchId}" data-id="match${matchCount}">Delete</button>
            <button class="btn btn-info ms-2 checkResult" data-id="match${matchCount}" onclick="checkMatchResult(this)">Check</button>
          </div>
          <div class="mt-2 small text-muted">Sport Key: ${match.sportKey || 'N/A'}</div>
        `;
        container.appendChild(matchDiv);

        // Add event listener for checkbox
        document.getElementById(`checkbox${matchCount}`).addEventListener('change', (e) => {
          if (e.target.checked) {
            matchDiv.classList.add('match-selected');
            matchDiv.style.backgroundColor = '#e8f4ff';
          } else {
            matchDiv.classList.remove('match-selected');
            matchDiv.style.backgroundColor = '';
          }
        });

        // Add event listener for delete button
        document.querySelector(`[data-id="match${matchCount}"].deleteMatch`).addEventListener('click', async (e) => {
          const matchId = e.target.dataset.matchId;
          if (confirm(`Are you sure you want to delete match ${matchId}?`)) {
            try {
              const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/delete-match/${matchId}`, {
                method: 'DELETE'
              });

              if (response.ok) {
                document.getElementById('status').innerHTML = `
                  <div class="alert alert-success">Match deleted successfully</div>
                `;
                // Remove the match from the DOM
                const matchElement = document.querySelector(`[data-match-id="${matchId}"]`);
                if (matchElement) {
                  matchElement.remove();
                }
              } else {
                const errorData = await response.json();
                document.getElementById('status').innerHTML = `
                  <div class="alert alert-danger">${errorData.error || 'Failed to delete match'}</div>
                `;
              }
            } catch (error) {
              console.error('Error deleting match:', error);
              document.getElementById('status').innerHTML = `
                <div class="alert alert-danger">Error deleting match. Please try again.</div>
              `;
            }
          }
        });
      });
    }

    async function fetchMatches(sportKey) {
      if (!sportKey) {
        sportKey = document.getElementById('sportKey').value;
      }

      if (!sportKey) {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-warning">Please enter a sport key</div>
        `;
        return;
      }

      try {
        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/matches/${sportKey}`);
        if (!response.ok) {
          throw new Error('Failed to fetch matches');
        }

        const matches = await response.json();
        displayMatches(matches);
      } catch (error) {
        console.error('Error fetching matches:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">${error.message || 'Failed to fetch matches'}</div>
        `;
      }
    }

    document.getElementById('submitMatches').addEventListener('click', async () => {
      const matches = [];
      document.querySelectorAll('#matchesContainer > div').forEach(div => {
        // Skip if this is a filter div or other non-match div
        if (!div.querySelector('[data-type="matchId"]')) return;

        const id = div.querySelector('[data-type="matchId"]').dataset.id;
        const matchId = div.querySelector('[data-type="matchId"]').value;

        if (!matchId) return; // Skip if no match ID

        const match = {
          matchId: matchId,
          teamA: div.querySelector('[data-type="teamA"]').value,
          teamB: div.querySelector('[data-type="teamB"]').value,
          oddsA: parseFloat(div.querySelector('[data-type="oddsA"]').value) || 0,
          oddsB: parseFloat(div.querySelector('[data-type="oddsB"]').value) || 0,
          scoreA: div.querySelector('[data-type="scoreA"]').value ? parseInt(div.querySelector('[data-type="scoreA"]').value) : null,
          scoreB: div.querySelector('[data-type="scoreB"]').value ? parseInt(div.querySelector('[data-type="scoreB"]').value) : null,
          sportKey: document.getElementById('sportKey').value || 'soccer_uefa_champs_league_qualification'
        };
        matches.push(match);
      });

      if (matches.length === 0) {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-warning">No matches to submit</div>
        `;
        return;
      }

      try {
        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Submitting ${matches.length} matches...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/matches`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ matches }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to submit matches');
        }

        const data = await response.json();

        // Create a detailed response message
        let statusHtml = `<div class="alert alert-success">
          <h5>${data.message}</h5>
        `;

        // Show details about added matches
        if (data.results.added && data.results.added.length > 0) {
          statusHtml += `
            <div class="mt-3">
              <strong>Added Matches (${data.results.added.length}):</strong>
              <ul class="mb-0">
          `;
          data.results.added.forEach(match => {
            statusHtml += `<li>${match.teamA} vs ${match.teamB} (ID: ${match.matchId})</li>`;
          });
          statusHtml += `</ul></div>`;
        }

        // Show details about updated matches
        if (data.results.updated && data.results.updated.length > 0) {
          statusHtml += `
            <div class="mt-3">
              <strong>Updated Matches (${data.results.updated.length}):</strong>
              <ul class="mb-0">
          `;
          data.results.updated.forEach(match => {
            statusHtml += `<li>${match.teamA} vs ${match.teamB} (ID: ${match.matchId})</li>`;
          });
          statusHtml += `</ul></div>`;
        }

        // Show details about duplicate matches
        if (data.results.duplicates && data.results.duplicates.length > 0) {
          statusHtml += `
            <div class="mt-3">
              <strong class="text-warning">Skipped Duplicate Matches (${data.results.duplicates.length}):</strong>
              <ul class="mb-0">
          `;
          data.results.duplicates.forEach(match => {
            statusHtml += `<li>${match.teamA} vs ${match.teamB} - Already exists with ID: ${match.existingMatchId}</li>`;
          });
          statusHtml += `</ul></div>`;
        }

        statusHtml += `</div>`;
        document.getElementById('status').innerHTML = statusHtml;

        // Refresh the matches display if any were added or updated
        if ((data.results.added && data.results.added.length > 0) ||
          (data.results.updated && data.results.updated.length > 0)) {
          const sportKey = document.getElementById('sportKey').value;
          if (sportKey) {
            fetchMatches(sportKey);
          } else {
            document.getElementById('queryMatches').click();
          }
        }
      } catch (error) {
        console.error('Error submitting matches:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">${error.message || 'Failed to submit matches'}</div>
        `;
      }
    });

    // Create sample matches functionality
    document.getElementById('createSampleMatches').addEventListener('click', async () => {
      try {
        const sportKey = document.getElementById('sportKey').value || 'soccer_uefa_champs_league_qualification';

        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Creating sample matches for ${sportKey}...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/create-sample-matches`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sportKey }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to create sample matches');
        }

        const data = await response.json();
        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">
            ${data.message} (${data.count} matches created)
          </div>
        `;

        // Display the newly created matches
        displayMatches(data.matches);
      } catch (error) {
        console.error('Error creating sample matches:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">
            ${error.message || 'Error creating sample matches. Please try again.'}
          </div>
        `;
      }
    });

    // Delete all matches functionality
    document.getElementById('deleteAllMatches').addEventListener('click', async () => {
      try {
        const sportKey = document.getElementById('sportKey').value;
        const confirmMessage = sportKey
          ? `Are you sure you want to delete all matches for sport key '${sportKey}'?`
          : 'Are you sure you want to delete ALL matches?';

        if (!confirm(confirmMessage)) {
          return;
        }

        document.getElementById('status').innerHTML = `
          <div class="alert alert-info">Deleting matches...</div>
        `;

        const response = await fetch(`${window.APP_CONFIG.API_BASE_URL}/api/admin/delete-all-matches`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ sportKey }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to delete matches');
        }

        const data = await response.json();
        document.getElementById('status').innerHTML = `
          <div class="alert alert-success">
            ${data.message} (${data.count} matches deleted)
          </div>
        `;

        // Refresh the matches display
        document.getElementById('matchesContainer').innerHTML = '';
        if (sportKey) {
          fetchMatches(sportKey);
        } else {
          const queryMatchesBtn = document.getElementById('queryMatches');
          if (queryMatchesBtn) {
            queryMatchesBtn.click();
          }
        }
      } catch (error) {
        console.error('Error deleting matches:', error);
        document.getElementById('status').innerHTML = `
          <div class="alert alert-danger">
            ${error.message || 'Error deleting matches. Please try again.'}
          </div>
        `;
      }
    });
  </script>
</body>

</html>